{% extends 'base.html' %}
{% load static %}

{% block title %}Transacciones{% endblock %}

{% block content %}
<h2>ðŸ’¸ Transacciones</h2>

<div class="card" style="max-width:400px; margin:20px;">
  <div class="card-header">
    <strong>Historial de transacciones</strong>
  </div>
  <div class="card-body">
    <ul class="nav nav-tabs mb-3">
      <li class="nav-item">
        <button class="nav-link active" id="tab-todas" type="button">Todas</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="tab-ingresos" type="button">Ingresos</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" id="tab-egresos" type="button">Egresos</button>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane fade show active" id="todas" role="tabpanel" aria-labelledby="tab-todas">
        <ul class="list-group">
          {% for transaccion in transacciones %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <span style="font-weight:bold;">
                  {% if transaccion.descripcion != 'Sin descripciÃ³n' %}
                    {{ transaccion.descripcion }}
                  {% else %}
                    <span class="text-muted">Sin descripciÃ³n</span>
                  {% endif %}
                </span><br>
                <small>{{ transaccion.categoria }}</small>
              </div>
              <div class="text-end">
                <span style="font-weight:bold;">${{ transaccion.monto }}</span><br>
                <small>{{ transaccion.fecha|date:"d/m/Y H:i" }}</small>
              </div>
            </li>
          {% empty %}
            <li class="list-group-item">No hay transacciones registradas.</li>
          {% endfor %}
        </ul>
      </div>

      <div class="tab-pane fade" id="ingresos" role="tabpanel" aria-labelledby="tab-ingresos">
        <ul class="list-group">
          {% for transaccion in transacciones %}
            {% if 'Ingreso' in transaccion.categoria %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <span style="font-weight:bold;">{{ transaccion.descripcion }}</span><br>
                  <small>{{ transaccion.categoria }}</small>
                </div>
                <div class="text-end">
                  <span style="font-weight:bold;">${{ transaccion.monto }}</span><br>
                  <small>{{ transaccion.fecha|date:"d/m/Y H:i" }}</small>
                </div>
              </li>
            {% endif %}
          {% empty %}
            <li class="list-group-item">No hay ingresos registrados.</li>
          {% endfor %}
        </ul>
      </div>

      <div class="tab-pane fade" id="egresos" role="tabpanel" aria-labelledby="tab-egresos">
        <ul class="list-group">
          {% for transaccion in transacciones %}
            {% if transaccion.categoria == 'Egreso' %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <span style="font-weight:bold;">{{ transaccion.descripcion }}</span><br>
                  <small>{{ transaccion.categoria }}</small>
                </div>
                <div class="text-end">
                  <span style="font-weight:bold;">${{ transaccion.monto }}</span><br>
                  <small>{{ transaccion.fecha|date:"d/m/Y H:i" }}</small>
                </div>
              </li>
            {% endif %}
          {% empty %}
            <li class="list-group-item">No hay egresos registrados.</li>
          {% endfor %}
        </ul>
      </div>
    </div>

  </div>
</div>

<script src="{% static 'js/transacciones.js' %}"></script>

  <!-- Historial de cierres de caja -->
  <div class="card" style="max-width:400px; margin:20px;">
    <div class="card-header">
      <strong>Historial de cierres de caja</strong>
    </div>
    <div class="card-body">
      {% if cajas %}
        <ul class="list-group">
          {% for caja in cajas %}
            <li class="list-group-item">
              <div style="font-weight:bold;">Cerrada: {{ caja.closed_at|date:"d/m/Y H:i" }}</div>
              <div>Apertura: {{ caja.opened_at|date:"d/m/Y H:i" }} | Monto apertura: ${{ caja.opening_amount }}</div>
              <div>Monto cierre: ${{ caja.closing_amount }}</div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>No hay cierres de caja registrados.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
